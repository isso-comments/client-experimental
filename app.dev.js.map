{"version":3,"file":"app.dev.js","mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB,eAAe;AACjC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,eAAe;AAC/B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,eAAe,2CAA2C;AAC1D;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB;AACnB,+CAA+C,0BAA0B;AACzE;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA,mBAAmB;AACnB,wDAAwD,aAAa;AACrE;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA,mBAAmB;;AAEnB,uCAAuC;AACvC,8CAA8C;AAC9C,wCAAwC;;AAExC,oBAAoB;;AAEpB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR,0BAA0B,iBAAiB;AAC3C,QAAQ;AACR;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA,yCAAyC,uBAAuB;AAChE;;AAEA;AACA,mBAAmB;AACnB;AACA,4DAA4D,WAAW;AACvE;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,MAAM;AACN;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC1SA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,YAAY,mBAAO,CAAC,6BAAO;;AAE3B;AACA;AACA;;AAEA,gBAAgB,mBAAO,CAAC,qCAAW;;AAEnC,wCAAwC;;AAExC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;;AAEnB,uDAAuD,mBAAmB;;AAE1E;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR,uCAAuC,uCAAuC;AAC9E;AACA;AACA;AACA,eAAe;AACf;AACA,MAAM;AACN;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA;AACA,QAAQ;AACR;AACA,wCAAwC;AACxC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA,mBAAmB,yDAAyD;AAC5E;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB;AACnB;AACA;AACA,mBAAmB,8CAA8C;AACjE;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB,+CAA+C;;AAE/C;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,wBAAwB,4BAA4B;AACpD;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA,GAAG;AACH;AACA;AACA,mBAAmB;AACnB;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;;AAIA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,8DAA8D,mBAAmB;;AAEjF;;AAEA;AACA;;AAEA;AACA,mBAAmB;;AAEnB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;;;;;;;;;;ACzYA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;;;;;;;;;;ACzBA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA,YAAY,mBAAO,CAAC,6BAAO;;AAE3B;;AAEA,gBAAgB,mBAAO,CAAC,qCAAW;;AAEnC;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB,sBAAsB;AACtB;;AAEA;AACA;;AAEA,mBAAmB;;AAEnB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,mBAAmB;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,GAAG;AACH;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;;AAEA;AACA,mBAAmB;;AAEnB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;;;;;;;;;;ACtLA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sCAAsC,oBAAoB;AAC1D;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAa;AACb,YAAY;AACZ,YAAY;AACZ,cAAc;AACd,aAAa;AACb,cAAc;AACd;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,oBAAoB;AACtC;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK,IAAI;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC5HA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA,oBAAoB,mBAAO,CAAC,iCAAS;AACrC,cAAc,mBAAO,CAAC,iCAAS;;;AAG/B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;;AAEA;AACA,mBAAmB;AACnB;AACA;AACA;;AAEA;AACA;AACA;;;;;;;UC3DA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;;;ACtBa;;AAEb,WAAW,mBAAO,CAAC,yBAAK;AACxB;;AAEA,aAAa,mBAAO,CAAC,+BAAQ;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","sources":["webpack://isso-experiment/./src/api.js","webpack://isso-experiment/./src/comment.js","webpack://isso-experiment/./src/editorify.js","webpack://isso-experiment/./src/postbox.js","webpack://isso-experiment/./src/utils.js","webpack://isso-experiment/./src/widget.js","webpack://isso-experiment/webpack/bootstrap","webpack://isso-experiment/./src/app.js"],"sourcesContent":["/*\nUses:\n- promises/Q\n  -> functional\n- globals\n  -> stateful\n\nOne-time setup:\n- salt\n  -> constant\n- location\n  -> DOM dependent\n- endpoint\n  -> DOM dependent\n\n(Private) helper functions:\n- curl\n  -> also updates globals offset on every server response, should probably not do that?\n  -> should probably be window.Isso.globals.offset?\n- qs\n\nFunctions, rely on endpoint:\n- create\n- modify\n- remove\n- view\n- fetch\n- count\n- like\n- dislike\n- feed\n- preview\n*/\n\nvar Q = function(){};\nvar globals = function(){};\n//var Q = require('lib/promise');\n//var globals = require('globals');\n\nvar salt = \"Eech7co8Ohloopo9Ol6baimi\";\n\n// DOM dependent\nvar getLocation = function() {\n  return window.location.pathname;\n};\n\n// DOM dependent\nvar getEndpoint = function() {\n  var js = document.getElementsByTagName(\"script\");\n  var script;\n  var url;\n\n  // prefer `data-isso=\"//host/api/endpoint\"` if provided\n  for (var i = 0; i < js.length; i++) {\n    if (js[i].hasAttribute(\"data-isso\")) {\n      url = js[i].getAttribute(\"data-isso\");\n      break;\n    }\n  }\n\n  // if no async-script is embedded, use the last script tag of `js`\n  if (!url) {\n    for (i = 0; i < js.length; i++) {\n      if (js[i].getAttribute(\"async\") || js[i].getAttribute(\"defer\")) {\n        throw \"Isso's automatic configuration detection failed, please \" +\n              \"refer to https://github.com/posativ/isso#client-configuration \" +\n              \"and add a custom `data-isso` attribute.\";\n      }\n    }\n\n    script = js[js.length - 1];\n    url = script.src.substring(0, script.src.length - \"/js/embed.min.js\".length);\n  }\n\n  //  strip trailing slash\n  if (url[url.length - 1] === \"/\") {\n    url = url.substring(0, url.length - 1);\n  }\n\n  return url;\n};\n\n// DOM dependent\n// Split into own function to allow mocking\nvar _updateTimeOffset = function(time) {\n  globals.offset.update(new Date(date));\n};\n\n// DOM dependent\n// Split into own function to allow mocking\nvar _updateCookie = function(cookie) {\n  document.cookie = cookie;\n};\n\nvar _curl = function(method, url, data, resolve, reject) {\n  var xhr = new XMLHttpRequest();\n  function onload() {\n    var date = xhr.getResponseHeader(\"Date\");\n    if (date !== null) {\n      updateTimeOffset(new Date(date));\n    }\n    var cookie = xhr.getResponseHeader(\"X-Set-Cookie\");\n    if (cookie && cookie.match(/^isso-/)) {\n      updateCookie(cookie);\n    }\n    if (xhr.status >= 500) {\n      if (reject) {\n        reject(xhr.body);\n      }\n    } else {\n      resolve({status: xhr.status, body: xhr.responseText});\n    }\n  }\n  try {\n    xhr.open(method, url, true);\n    xhr.withCredentials = true;\n    xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState === 4) {\n        onload();\n      }\n    };\n  } catch (exception) {\n    (reject || console.log)(exception.message);\n  }\n  xhr.send(data);\n};\n\n// Encode URI\nvar _qs = function(params) {\n    var rv = \"\";\n    for (var key in params) {\n        if (params.hasOwnProperty(key) &&\n            params[key] !== null && typeof(params[key]) !== \"undefined\") {\n            rv += key + \"=\" + encodeURIComponent(params[key]) + \"&\";\n        }\n    }\n    return rv.substring(0, rv.length - 1);  // chop off trailing \"&\"\n};\n\n\nvar API = function() {\n  this.location = null;\n  this.endpoint = null;\n}\n\nAPI.prototype.create = function(tid, data) {\n  var deferred = Q.defer();\n  var self = this; // Preserve Object context\n  _curl(\"POST\", self.endpoint + \"/new?\" + _qs({uri: tid || self.location}), JSON.stringify(data),\n    function (rv) {\n      if (rv.status === 201 || rv.status === 202) {\n        deferred.resolve(JSON.parse(rv.body));\n      } else {\n        deferred.reject(rv.body);\n      }\n    });\n  return deferred.promise;\n};\n\nAPI.prototype.modify = function(endpoint, id, data) {\n  var deferred = Q.defer();\n  var self = this; // Preserve Object context\n  _curl(\"PUT\", self.endpoint + \"/id/\" + id, JSON.stringify(data), function (rv) {\n    if (rv.status === 403) {\n      deferred.reject(\"Not authorized to modify this comment!\");\n    } else if (rv.status === 200) {\n      deferred.resolve(JSON.parse(rv.body));\n    } else {\n      deferred.reject(rv.body);\n    }\n  });\n  return deferred.promise;\n};\n\nAPI.prototype.remove = function(id) {\n  var deferred = Q.defer();\n  var self = this; // Preserve Object context\n  _curl(\"DELETE\", self.endpoint + \"/id/\" + id, null, function(rv) {\n    if (rv.status === 403) {\n      deferred.reject(\"Not authorized to remove this comment!\");\n    } else if (rv.status === 200) {\n      deferred.resolve(JSON.parse(rv.body) === null);\n    } else {\n      deferred.reject(rv.body);\n    }\n  });\n  return deferred.promise;\n};\n\nAPI.prototype.view = function(id, plain) {\n  var deferred = Q.defer();\n  var self = this; // Preserve Object context\n  _curl(\"GET\", self.endpoint + \"/id/\" + id + \"?\" + _qs({plain: plain}), null,\n    function(rv) {\n      if (rv.status === 200) {\n        deferred.resolve(JSON.parse(rv.body));\n      } else {\n        deferred.reject(rv.body);\n      }\n    });\n  return deferred.promise;\n};\n\nAPI.prototype.fetch = function(tid, limit, nested_limit, parent, lastcreated) {\n  var self = this; // Preserve Object context\n\n  if (typeof(limit) === 'undefined') { limit = \"inf\"; }\n  if (typeof(nested_limit) === 'undefined') { nested_limit = \"inf\"; }\n  if (typeof(parent) === 'undefined') { parent = null; }\n\n  var query_dict = {uri: tid || self.location, after: lastcreated, parent: parent};\n\n  if(limit !== \"inf\") {\n    query_dict['limit'] = limit;\n  }\n  if(nested_limit !== \"inf\"){\n    query_dict['nested_limit'] = nested_limit;\n  }\n\n  var deferred = Q.defer();\n  _curl(\"GET\", self.endpoint + \"/?\" +\n    _qs(query_dict), null, function(rv) {\n      if (rv.status === 200) {\n        deferred.resolve(JSON.parse(rv.body));\n      } else if (rv.status === 404) {\n        deferred.resolve({total_replies: 0});\n      } else {\n        deferred.reject(rv.body);\n      }\n    });\n  return deferred.promise;\n};\n\nAPI.prototype.count = function(urls) {\n  var self = this; // Preserve Object context\n  var deferred = Q.defer();\n  _curl(\"POST\", self.endpoint + \"/count\", JSON.stringify(urls), function(rv) {\n    if (rv.status === 200) {\n      deferred.resolve(JSON.parse(rv.body));\n    } else {\n      deferred.reject(rv.body);\n    }\n  });\n  return deferred.promise;\n};\n\nAPI.prototype.like = function(id) {\n  var self = this; // Preserve Object context\n  var deferred = Q.defer();\n  _curl(\"POST\", self.endpoint + \"/id/\" + id + \"/like\", null, function(rv) {\n    if (rv.status === 200) {\n      deferred.resolve(JSON.parse(rv.body));\n    } else {\n      deferred.reject(rv.body);\n    }\n  });\n  return deferred.promise;\n};\n\nAPI.prototype.dislike = function(id) {\n  var self = this; // Preserve Object context\n  var deferred = Q.defer();\n  _curl(\"POST\", self.endpoint + \"/id/\" + id + \"/dislike\", null, function(rv) {\n    if (rv.status === 200) {\n      deferred.resolve(JSON.parse(rv.body));\n    } else {\n      deferred.reject(rv.body);\n    }\n  });\n  return deferred.promise;\n};\n\nAPI.prototype.feed = function(tid) {\n  return this.endpoint + \"/feed?\" + _qs({uri: tid || location()});\n};\n\nAPI.prototype.preview = function(text) {\n  var self = this; // Preserve Object context\n  var deferred = Q.defer();\n  _curl(\"POST\", self.endpoint + \"/preview\", JSON.stringify({text: text}),\n    function(rv) {\n       if (rv.status === 200) {\n         deferred.resolve(JSON.parse(rv.body).text);\n       } else {\n         deferred.reject(rv.body);\n       }\n     });\n  return deferred.promise;\n};\n\n\nmodule.exports = {\n  API: API,\n  salt: salt,\n  getLocation: getLocation,\n  getEndpoint: getEndpoint,\n};\n","/*\nUses:\n- DOM/jquery $ impl\n  -> functional\n- utils\n  -> functional\n- identicons\n  -> functional\n- globals\n  -> stateful\n- template\n  -> dependent on i18n+conf\n- config\n  -> data-isso-* attrs, enriched with conf fetched from server (catch-22)\n- api\n  -> dependent on data-isso-* attrs, stateful\n- i18n\n  -> dependent on language selection+conf\n\nOne-time setup:\n\nFunctions:\n\nFunctions (DOM-dependent):\n\nFunctions (dependent on config):\n*/\n\nvar utils = require('utils');\n\nvar $ = function(){};\nvar identicons = function(){};\nvar globals = function(){};\n\nvar editorify = require('editorify');\n\nvar DEFAULT_COOKIE_TIMEOUT = 15 * 1000; // 15 minutes = Default edit cookie validity\n\nvar Comment = function() {\n  this.api = null;\n  this.config = null;\n  this.i18n = null;\n  this.template = null;\n  this.widget = null;\n\n  // Own DOM elements\n  this.element = null;\n  this.header = null;\n  this.footer = null;\n  this.text = null;\n};\n\nComment.prototype.constructor = function(api, config, i18n, template, widget) {\n  this.api = api;\n  this.config = config;\n  this.i18n = i18n;\n  this.template = template;\n  this.widget = widget;\n};\n\nComment.prototype.insertComment = function(comment, scrollIntoView) {\n  var self = this; // Preserve Comment object instance context\n\n  self.element = $.htmlify(template.render(\"comment\", {\"comment\": comment}));\n\n  if (self.config[\"avatar\"]) {\n    $(\".isso-avatar > svg\", self.element).replace(\n        identicons.generate(comment.hash, 4, 48, self.config));\n  }\n\n  var entrypoint;\n  if (comment.parent === null) {\n    entrypoint = $(\"#isso-root\");\n  } else {\n    entrypoint = $(\"#isso-\" + comment.parent + \" > .isso-follow-up\");\n  }\n\n  entrypoint.append(self.element);\n\n  if (scrollIntoView) {\n    self.element.scrollIntoView();\n  }\n\n  self.footer = $(\"#isso-\" + comment.id + \" > .isso-text-wrapper > .isso-comment-footer\");\n  self.header = $(\"#isso-\" + comment.id + \" > .isso-text-wrapper > .isso-comment-header\");\n  self.text   = $(\"#isso-\" + comment.id + \" > .isso-text-wrapper > .isso-text\");\n\n  var form = null;\n  $(\"a.isso-reply\", self.footer).toggle(\"click\",\n    function(toggler) {\n      self.toggleReply(toggler, comment, form);\n    },\n    function(toggler) {\n      self.toggleReply(toggler, comment, form);\n    }\n  );\n\n  $(\"a.isso-edit\", self.footer).toggle(\"click\",\n    function(toggler) {\n      self.toggleEdit(toggler, comment);\n    },\n    function(toggler) {\n      self.toggleEdit(toggler, comment);\n    }\n  );\n\n  $(\"a.isso-delete\", self.footer).toggle(\"click\",\n    function(toggler) {\n      self.toggleDelete(toggler, comment);\n    },\n    function(toggler) {\n      self.toggleDelete(toggler, comment);\n    }\n  );\n\n  if(comment.hasOwnProperty('replies')) {\n    self.insertReplies(comment);\n  }\n\n  if (self.config[\"vote\"]) {\n    $(\"a.isso-upvote\", self.footer).on(\"click\", self.like);\n    $(\"a.isso-downvote\", self.footer).on(\"click\", self.dislike);\n\n    updateVotes(comment.likes - comment.dislikes);\n  }\n\n  // Beware: Following statements all use setTimeout()!\n\n  // Update calculated offset to comment creation every 60 seconds\n  self.updateOffsetLoop();\n  // Remove edit and delete buttons when cookie is expired\n  self.checkIneditableLoop(comment, \"a.isso-edit\");\n  self.checkIneditableLoop(comment, \"a.isso-delete\");\n  // Allow replying to self if a) reply-to-self enabled or b) cookie expired\n  if (! self.config[\"reply-to-self\"] && utils.cookie(\"isso-\" + comment.id)) {\n    var reply = $(\"a.isso-reply\", self.footer).detach();\n    showDirectReplyDelayed(reply, comment);\n  }\n};\n\nComment.prototype.updateOffset = function() {\n  var self = this; // Preserve Comment object instance context\n  $(\".isso-permalink > time\", self.element).textContent = i18n.ago(\n      globals.offset.localTime(),\n      new Date(parseInt(comment.created, 10) * 1000));\n};\nComment.prototype.updateOffsetLoop = function() {\n  var self = this; // Preserve Comment object instance context\n  self.updateOffset();\n  // TODO Create only one (global) timer, not per-comment\n  setTimeout(self.updateOffsetLoop, 60*1000);\n};\n\n// On clicking reply/close, insert/remove (\"toggle\") Postbox below comment\nComment.prototype.toggleReply = function(toggler, comment, form) {\n  if (!toggler.state) {\n    var parent = comment.parent === null ? comment.id : comment.parent;\n    form = self.footer.insertAfter(self.widget.createPostbox(parent))\n    form.onsuccess = function() { toggler.next(); };\n    $(\".isso-textarea\", form).focus();\n    // TODO Move those i18n calls into pre-rendered datasets in template\n    $(\"a.isso-reply\", self.footer).textContent = self.i18n.translate(\"comment-close\");\n  } else {\n    form.remove();\n    $(\"a.isso-reply\", self.footer).textContent = self.i18n.translate(\"comment-reply\");\n  }\n};\n\nComment.prototype.toggleEdit = function(toggler, comment) {\n  var edit = $(\"a.isso-edit\", self.footer);\n  var avatar = self.config[\"avatar\"]\n      || self.config[\"gravatar\"] ? $(\".isso-avatar\", self.element, false)[0] : null;\n\n  if (!toggler.state) {\n    edit.textContent = self.i18n.translate(\"comment-save\");\n    edit.insertAfter($.new(\"a.isso-cancel\", i18n.translate(\"comment-cancel\")))\n      .on(\"click\", function() {\n        toggler.canceled = true;\n        toggler.next();\n      });\n\n    toggler.canceled = false;\n    self.api.view(comment.id, 1).then(function(rv) {\n      var textarea = editorify($.new(\"div.isso-textarea\"));\n\n      textarea.innerHTML = utils.detext(rv.text);\n      textarea.focus();\n\n      self.text.classList.remove(\"isso-text\");\n      self.text.classList.add(\"isso-textarea-wrapper\");\n\n      self.text.textContent = \"\";\n      self.text.append(textarea);\n    });\n\n    if (avatar !== null) {\n      avatar.hide();\n    }\n  } else {\n    var textarea = $(\".isso-textarea\", self.text);\n    if (! toggler.canceled && textarea !== null) {\n      if (utils.text(textarea.innerHTML).length < 3) {\n          textarea.focus();\n          toggler.wait();\n          return;\n      } else {\n          self.api.modify(comment.id, {\"text\": utils.text(textarea.innerHTML)})\n              .then(function(rv) {\n                self.text.innerHTML = rv.text;\n                comment.text = rv.text;\n              });\n      }\n    } else {\n      self.text.innerHTML = comment.text;\n    }\n\n    self.text.classList.remove(\"isso-textarea-wrapper\");\n    self.text.classList.add(\"isso-text\");\n\n    if (avatar !== null) {\n      avatar.show();\n    }\n\n    $(\"a.isso-cancel\", self.footer).remove();\n    edit.textContent = self.i18n.translate(\"comment-edit\");\n  }\n};\n\nComment.prototype.toggleDelete = function(toggler, comment) {\n  var del = $(\"a.isso-delete\", self.footer);\n  if (!toggler.state) {\n    var state = ! toggler.state;\n\n    del.textContent = self.i18n.translate(\"comment-confirm\");\n    del.on(\"mouseout\", function() {\n      del.textContent = self.i18n.translate(\"comment-delete\");\n      toggler.state = state;\n      del.onmouseout = null;\n    });\n  } else {\n    self.api.remove(comment.id).then(function(rv) {\n      if (rv) {\n        self.element.remove();\n      } else {\n        $(\"span.isso-note\", self.header).textContent = self.i18n.translate(\"comment-deleted\");\n        self.text.innerHTML = \"<p>&nbsp;</p>\";\n        $(\"a.isso-edit\", self.footer).remove();\n        $(\"a.isso-delete\", self.footer).remove();\n      }\n      del.textContent = i18n.translate(\"comment-delete\");\n    });\n  }\n};\n\n// Remove edit and delete buttons when cookie is gone\nComment.prototype.checkIneditable = function (comment, button) {\n  if (! utils.cookie(\"isso-\" + comment.id)) {\n    if ($(button, self.footer) !== null) {\n      $(button, self.footer).remove();\n      return true;\n    }\n  }\n  return false;\n};\nComment.prototype.checkIneditableLoop = function(comment, button) {\n  var self = this; // Preserve Comment object instance context\n  if (!self.ineditable(comment, self.footer, button)) {\n    // TODO Create only one (global) timer, not per-comment\n    setTimeout(\n      function() { self.checkIneditableLoop(comment, self.footer, button); },\n      DEFAULT_COOKIE_TIMEOUT\n    );\n  };\n};\n\n// Show direct reply to own comment when cookie is max aged\nComment.prototype.showDirectReplyDelayed = function(reply, comment) {\n  var self = this; // Preserve Comment object instance context\n  if (utils.cookie(\"isso-\" + comment.id)) {\n    setTimeout(\n      function() { self.showDirectReplyDelayed(reply, comment); },\n      DEFAULT_COOKIE_TIMEOUT\n    );\n  } else {\n    self.footer.append(reply);\n  }\n};\n\nComment.prototype.updateVotes = function(value) {\n  var self = this; // Preserve Comment object instance context\n  var voteLevels = self.config[\"vote-levels\"]; // Shorthand\n\n  var span = $(\"span.isso-votes\", self.footer);\n  if (span === null) {\n    self.footer.prepend($.new(\"span.isso-votes\", value));\n  } else {\n    span.textContent = value;\n  }\n  if (value) {\n    self.element.classList.remove('isso-no-votes');\n  } else {\n    self.element.classList.add('isso-no-votes');\n  }\n  if (voteLevels) {\n    var before = true;\n    for (var index = 0; index <= voteLevels.length; index++) {\n      if (before && (index >= voteLevels.length || value < voteLevels[index])) {\n        self.element.classList.add('isso-vote-level-' + index);\n        before = false;\n      } else {\n        self.element.classList.remove('isso-vote-level-' + index);\n      }\n    }\n  }\n};\n\nComment.prototype.upvote = function() {\n  var self = this; // Preserve Comment object instance context\n  self.api.like(comment.id).then(function (rv) {\n    self.updateVotes(rv.likes - rv.dislikes);\n  });\n};\nComment.prototype.downvote = function() {\n  var self = this; // Preserve Comment object instance context\n  self.api.dislike(comment.id).then(function (rv) {\n    self.updateVotes(rv.likes - rv.dislikes);\n  });\n};\n\nComment.prototype.insertReplies = function(comment) {\n  var lastCreated = 0;\n  comment.replies.forEach(function(replyObject) {\n    self.insertComment(replyObject, false);\n    if(replyObject.created > lastCreated) {\n      lastCreated = replyObject.created;\n    }\n  });\n  if(comment.hidden_replies > 0) {\n    self.insertLoader(comment, lastCreated);\n  }\n};\n\n\n\nComment.prototype.insertLoader = function(comment, lastCreated) {\n  var self = this; // Preserve Comment object instance context\n  var entrypoint;\n  if (comment.id === null) {\n    entrypoint = $(\"#isso-root\");\n    comment.name = 'null';\n  } else {\n    entrypoint = $(\"#isso-\" + comment.id + \" > .isso-follow-up\");\n    comment.name = comment.id;\n  }\n  self.element = $.htmlify(template.render(\"comment-loader\", {\"comment\": comment}));\n\n  entrypoint.append(self.element);\n\n  $(\"a.isso-load-hidden\", self.element).on(\"click\", self.loadHidden);\n};\n\nComment.prototype.loadHidden = function() {\n  var self = this; // Preserve Comment object instance context\n\n  self.element.remove();\n\n  var tid = $(\"#isso-thread\").getAttribute(\"data-isso-id\") || null;\n  self.api.fetch(tid, self.config[\"reveal-on-click\"],\n      self.config[\"max-comments-nested\"], comment.id, lastCreated).then(\n    function(rv) {\n      if (rv.total_replies === 0) {\n          return;\n      }\n\n      var lastCreated = 0;\n      rv.replies.forEach(function(commentObject) {\n        self.insertComment(commentObject, false);\n        if(commentObject.created > lastCreated) {\n          lastCreated = commentObject.created;\n        }\n      });\n\n      if(rv.hidden_replies > 0) {\n        self.insertLoader(rv, lastCreated);\n      }\n    },\n    function(err) {\n      console.log(err);\n    });\n};\n\nmodule.exports = {\n  Comment: Comment,\n};\n","//var $ = require('dom');\nvar $ = function(){};\n\n// DOM dependent\nvar editorify = function(el) {\n  el = $.htmlify(el);\n  el.setAttribute(\"contentEditable\", true);\n  // Save placeholder \"Type comment here\" text\n  el.dataset[\"postbox-text\"] = el.textContent;\n\n  el.on(\"focus\", function() {\n    if (el.classList.contains(\"isso-placeholder\")) {\n      el.innerHTML = \"\";\n      el.classList.remove(\"isso-placeholder\");\n    }\n  });\n\n  el.on(\"blur\", function() {\n    if (el.textContent.length === 0) {\n      el.textContent = el.dataset[\"postbox-text\"] || \"\";\n      el.classList.add(\"isso-placeholder\");\n    }\n  });\n\n  return el;\n};\n","/*\nUses:\n- DOM/jquery $ impl\n  -> functional\n- utils\n  -> functional\n\nOne-time setup:\n\nFunctions:\n\nFunctions (DOM-dependent):\n\nFunctions (dependent on config):\n*/\n\nvar utils = require('utils');\n\nvar $ = function(){};\n\nvar editorify = require('editorify');\n\nvar ValidationError = {\n  TEXT_TOO_SHORT: 1,\n  EMAIL_MISSING: 2,\n  AUTHOR_MISSING: 3,\n};\n\n\nvar Postbox = function() {\n  this.api = null;\n  this.config = null;\n  this.element = null;\n  this.localStorage = null;\n  this.parent = null;\n  this.template = null; // does this need to be stateful?\n  this.widget = null; // this backref feels yuck\n}\n\nPostbox.prototype.constructor = function(parent, api, config,\n    localStorage, template, widget) {\n\n  var self = this; // Preserve Object context\n\n  self.parent = parent;\n  self.api = api;\n  self.config = config;\n  self.localStorage = localStorage;\n  self.template = template;\n  self.widget = widget;\n\n  self.element = $.htmlify(self.template.render(\"postbox\", {\n    \"author\":  JSON.parse(self.localStorage.getItem(\"isso-author\")),\n    \"email\":   JSON.parse(self.localStorage.getItem(\"isso-email\")),\n    \"website\": JSON.parse(self.localStorage.getItem(\"isso-website\")),\n    \"preview\": '',\n  }));\n\n  self.element.onsuccess = function() {};\n  self.element.validate = self.validate;\n  self.checkEmailRequired();\n  self.checkAuthorRequired();\n  $(\"[name='email']\", self.element).on(\"input\", self.emailEdit);\n  $(\"[name='preview']\", self.element).on(\"click\", self.preview);\n  $(\"[name='edit']\", self.element).on(\"click\", self.edit);\n  $(\".isso-preview\", self.element).on(\"click\", self.edit);\n  $(\"[type=submit]\", self.element).on(\"click\", self.submit);\n\n  editorify($(\".isso-textarea\", self.element));\n\n  return self.element;\n};\n\nPostbox.prototype.validate = function() {\n  var self = this; // Preserve Object context\n  var reasons = [];\n\n  if (utils.text($(\".isso-textarea\", self.element).innerHTML).length < 3 ||\n    $(\".isso-textarea\", self.element).classList.contains(\"isso-placeholder\"))\n  {\n    $(\".isso-textarea\", self.element).focus();\n    reasons.push(ValidationError.TEXT_TOO_SHORT);\n  }\n  if (self.config[\"require-email\"]\n      && $(\"[name='email']\", self.element).value.length <= 0)\n  {\n    $(\"[name='email']\", self.element).focus();\n    reasons.push(ValidationError.EMAIL_MISSING);\n  }\n  if (self.config[\"require-author\"]\n      && $(\"[name='author']\", self.element).value.length <= 0)\n  {\n    $(\"[name='author']\", self.element).focus();\n    reasons.push(ValidationError.AUTHOR_MISSING);\n  }\n  return reasons;\n};\n\nPostbox.prototype.emailEdit = function() {\n  var self = this; // Preserve Object context\n  if (self.config[\"reply-notifications\"]\n      && $(\"[name='email']\", self.element).value.length > 0)\n  {\n    $(\".isso-notification-section\", self.element).show();\n  } else {\n    $(\".isso-notification-section\", self.element).hide();\n  }\n};\n\nPostbox.prototype.checkEmailRequired = function() {\n  var self = this; // Preserve Object context\n  if (self.config[\"require-email\"]) {\n      $(\"[for='isso-postbox-email']\", self.element).textContent =\n          $(\"[for='isso-postbox-email']\", self.element).textContent.replace(/ \\(.*\\)/, \"\");\n  }\n};\nPostbox.prototype.checkAuthorRequired = function() {\n  var self = this; // Preserve Object context\n  if (self.config[\"require-author\"]) {\n    $(\"[for='isso-postbox-author']\", self.element).textContent =\n      $(\"[for='isso-postbox-author']\", self.element).textContent.replace(/ \\(.*\\)/, \"\");\n  }\n};\n\nPostbox.prototype.preview = function() {\n  var self = this; // Preserve Object context\n  $(\"[name='preview']\", self.element).on(\"click\", function() {\n    self.api.preview(utils.text($(\".isso-textarea\", self.element).innerHTML)).then(\n      function(html) {\n          $(\".isso-preview .isso-text\", self.element).innerHTML = html;\n          self.element.classList.add('isso-preview-mode');\n      });\n  });\n};\n\nPostbox.prototype.edit = function() {\n  var self = this; // Preserve Object context\n  $(\".isso-preview .isso-text\", self.element).innerHTML = '';\n  self.element.classList.remove('isso-preview-mode');\n};\n\nPostbox.prototype.submit = function() {\n  var self = this; // Preserve Object context\n\n  self.edit();\n  if (self.element.validate().length) {\n    // TODO: handle and display ValidationError\n    return;\n  }\n\n  var author = $(\"[name=author]\", self.element).value || null;\n  var email = $(\"[name=email]\", self.element).value || null;\n  var website = $(\"[name=website]\", self.element).value || null;\n\n  self.localStorage.setItem(\"isso-author\", JSON.stringify(author));\n  self.localStorage.setItem(\"isso-email\", JSON.stringify(email));\n  self.localStorage.setItem(\"isso-website\", JSON.stringify(website));\n\n  var tid = $(\"#isso-thread\").getAttribute(\"data-isso-id\") || null;\n  var title = $(\"#isso-thread\").getAttribute(\"data-title\") || null;\n  var text = utils.text($(\".isso-textarea\", self.element).innerHTML);\n\n  self.api.create(tid, {\n    author: author, email: email, website: website,\n    text: text, parent: self.parent || null, title: title,\n    notification: $(\"[name=notification]\", self.element).checked() ? 1 : 0,\n  }).then(function(comment) {\n    $(\".isso-textarea\", self.element).innerHTML = \"\";\n    $(\".isso-textarea\", self.element).blur();\n\n    // This backref feels yuck\n    self.widget.insertComment(comment, true);\n\n    if (parent !== null) {\n      self.element.onsuccess();\n    }\n  });\n};\n\nmodule.exports = {\n  Postbox: Postbox,\n  ValidationError: ValidationError,\n};\n","/*\nUses:\n(none)\n\nOne-time setup:\n- localStorageImpl\n  -> should only be called once and then return a handle\n\nFunctions:\n- cookie\n- detext\n- localStorageImpl\n- normalize_bcp47\n- pad\n- text\n*/\n\n// DOM dependent\n// return `cookie` string if set\nvar cookie = function(cookie) {\n  return (document.cookie.match('(^|; )' + cookie + '=([^;]*)') || 0)[2];\n};\n\nvar pad = function(n, width, z) {\n  z = z || '0';\n  n = n + '';\n  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n};\n\nvar HTMLEntity = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  \"/\": '&#x2F;'\n};\n\nvar escape = function(html) {\n  return String(html).replace(/[&<>\"'\\/]/g, function(s) {\n    return HTMLEntity[s];\n  });\n};\n\n// DOM dependent\n// should be removed since it just causes headaches with indented code\nvar text = function(html) {\n  var _ = document.createElement(\"div\");\n  _.innerHTML = html.replace(/<div><br><\\/div>/gi, '<br>')\n    .replace(/<div>/gi, '<br>')\n    .replace(/<br>/gi, '\\n')\n    .replace(/&nbsp;/gi, ' ');\n  return _.textContent.trim();\n};\n\n// DOM dependent\n// should be removed since it just causes headaches with indented code\nvar detext = function(text) {\n  text = escape(text);\n  return text.replace(/\\n\\n/gi, '<br><div><br></div>')\n    .replace(/\\n/gi, '<br>');\n};\n\n// Normalize a BCP47 language tag.\n// Quoting https://tools.ietf.org/html/bcp47 :\n//   An implementation can reproduce this format without accessing\n//   the registry as follows.  All subtags, including extension\n//   and private use subtags, use lowercase letters with two\n//   exceptions: two-letter and four-letter subtags that neither\n//   appear at the start of the tag nor occur after singletons.\n//   Such two-letter subtags are all uppercase (as in the tags\n//   \"en-CA-x-ca\" or \"sgn-BE-FR\") and four-letter subtags are\n//   titlecase (as in the tag \"az-Latn-x-latn\").\n// We also map underscores to dashes.\nvar normalize_bcp47 = function(tag) {\n  var subtags = tag.toLowerCase().split(/[_-]/);\n  var afterSingleton = false;\n  for (var i = 0; i < subtags.length; i++) {\n    if (subtags[i].length === 1) {\n      afterSingleton = true;\n    } else if (afterSingleton || i === 0) {\n      afterSingleton = false;\n    } else if (subtags[i].length === 2) {\n      subtags[i] = subtags[i].toUpperCase();\n    } else if (subtags[i].length === 4) {\n      subtags[i] = subtags[i].charAt(0).toUpperCase() +\n        subtags[i].substr(1);\n    }\n  }\n  return subtags.join(\"-\");\n};\n\n// DOM dependent\n// Safari private browsing mode supports localStorage, but throws QUOTA_EXCEEDED_ERR\nvar localStorageImpl = function() {\n  try {\n    localStorage.setItem(\"x\", \"y\");\n    localStorage.removeItem(\"x\");\n    return localStorage;\n  } catch (ex) {\n    localStorageFallback = (function(storage) {\n      return {\n        setItem: function(key, val) {\n          storage[key] = val;\n        },\n        getItem: function(key) {\n          return typeof(storage[key]) !== 'undefined' ? storage[key] : null;\n        },\n        removeItem: function(key) {\n          delete storage[key];\n        }\n      };\n    })({});\n    return localStorageFallback;\n  }\n};\n\nmodule.exports = {\n  cookie: cookie,\n  detext: detext,\n  localStorageImpl: localStorageImpl,\n  normalize_bcp47: normalize_bcp47,\n  pad: pad,\n  text: text,\n};\n","/*\nUses:\n- DOM/jquery $ impl\n  -> functional\n\nOne-time setup:\n\nFunctions:\n\nFunctions (DOM-dependent):\n\nFunctions (dependent on config):\n*/\n\n//var $ = require('dom');\nvar $ = function(){};\n\nvar commentHelper = require('comment');\nvar postbox = require('postbox');\n\n\nvar Widget = function() {\n  this.api = null;\n  this.config = null;\n  this.i18n = null;\n  this.localStorage = null;\n  this.template = null;\n};\n\nWidget.prototype.constructor = function(api, config, i18n, localStorage, template) {\n  this.api = api;\n  this.config = config;\n  this.i18n = i18n;\n  this.localStorage = localStorage;\n  this.template = template;\n};\n\nWidget.prototype.createPostbox = function(parent) {\n  var self = this; // Preserve Object context\n  var _postbox = new postbox.Postbox(parent, self.api, self.config,\n      self.localStorage, self.template, self);\n  return _postbox;\n};\n\nWidget.prototype.createComment = function() {\n  var self = this; // Preserve Object context\n  var _comment = new commentHelper.Comment(self.api, self.config, self.i18n,\n      self.template, self);\n  return _comment;\n};\n\nWidget.prototype.insertComment = function(comment, scrollIntoView) {\n  var self = this; // Preserve Object context\n  var _comment = self.createComment();\n  _comment.insert(comment, scrollIntoView);\n};\n\nmodule.exports = {\n  Widget: Widget,\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","'use strict';\n\nvar _api = require('api');\nvar api;\n\nvar widget = require('widget');\n\n// init() should set up Isso, fetch configs & insert Postbox\n//\n// also insert comment counters for links to threads on page?\n// -> IMO belongs into fetchComments? -> shove into own func\nfunction init() {\n  api = new _api.API();\n  api.location = _api.getLocation();\n  api.endpoint = _api.getEndpoint();\n  window.API = api;\n};\n\n// fetchComments() should.. fetch comments and insert them (or \"load more\")\nfunction fetchComments() {\n};\n\n// count() should set/update _all_ comment counters, including the one above the Postbox\nfunction count() {\n};\n\nwindow.App = {\n  init: init,\n  fetchComments: fetchComments,\n  count: count,\n};\n"],"names":[],"sourceRoot":""}